<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interactive Training Editor</title>
  <!-- Fabric JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
  <!-- Sortable JS (for sequence list) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <!-- Styles -->
  <?!= HtmlService.createHtmlOutputFromFile('css/styles').getContent(); ?>
</head>
<body class="editor-view">
  <!-- Toolbar -->
  <div id="toolbar">
    <div class="toolbar-group">
        <button id="new-button" title="New Project"><span class="icon">📄</span> New</button>
        <button id="save-button" title="Save Project"><span class="icon">💾</span> Save</button>
        <button id="load-button" title="Load Project"><span class="icon">📁</span> Load</button>
        <span id="project-title-display">Untitled Project</span>
         <span id="save-status" class="status-indicator"></span>
    </div>
    <div class="toolbar-group">
        <button id="add-rect-button" title="Add Rectangle"><span class="icon">⬜</span> Rect</button>
        <button id="add-ellipse-button" title="Add Ellipse"><span class="icon">⚪</span> Ellipse</button>
        <button id="add-text-button" title="Add Textbox"><span class="icon"> Aa </span> Text</button>
        <button id="delete-button" title="Delete Selected Element" disabled><span class="icon">🗑️</span> Delete</button>
    </div>
     <div class="toolbar-group">
       <!-- Add Zoom controls later if needed -->
       <!-- <button id="zoom-in-button"><span class="icon">➕</span></button> -->
       <!-- <button id="zoom-out-button"><span class="icon">➖</span></button> -->
       <!-- <button id="zoom-reset-button"><span class="icon">🔍</span></button> -->
     </div>
  </div>

  <!-- Main Content Area -->
  <div id="main-content">
    <!-- Slide Navigator -->
    <div id="slide-navigator">
      <h3>Slides</h3>
      <ul id="slide-list">
        <!-- Slide previews will be added here -->
      </ul>
      <button id="add-slide-button">+ Add Slide</button>
      <button id="delete-slide-button" disabled>- Delete Current Slide</button>
       <div class="slide-bg-upload">
          <h4>Slide Background</h4>
          <input type="file" id="slide-bg-input" accept="image/*" style="display: none;">
          <button id="upload-bg-button">Upload Image</button>
          <span id="current-bg-filename">No background set</span>
       </div>
    </div>

    <!-- Canvas Area -->
    <div id="canvas-container">
        <canvas id="editor-canvas"></canvas>
    </div>

    <!-- Right Sidebar -->
    <div id="right-sidebar">
      <div id="sidebar-tabs">
        <button class="tab-link active" data-tab="properties-panel">Properties</button>
        <button class="tab-link" data-tab="sequence-panel">Sequence</button>
      </div>

      <!-- Properties Panel Tab -->
      <div id="properties-panel" class="sidebar-tab-content active">
        <div id="element-properties-content">
            <!-- Content generated by editorUI.js -->
            <p class="placeholder-text">Select an element on the canvas to see its properties.</p>
        </div>
      </div>

      <!-- Sequence Panel Tab -->
      <div id="sequence-panel" class="sidebar-tab-content">
         <h3>Interaction Sequence</h3>
         <p class="help-text">Drag elements to reorder the sequence viewers will follow.</p>
        <ul id="sequence-list">
            <!-- Sequence items generated by editorUI.js -->
             <li class="placeholder-item">Add elements to the slide and enable interactions to build a sequence.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="quiz-editor-modal" class="modal">
      <div class="modal-content large">
          <span class="close-button" onclick="QuizEditor.close()">×</span>
          <h2>Quiz Editor</h2>
          <div id="quiz-editor-body">
             <!-- Content generated by quizEditor.js -->
          </div>
           <div class="modal-footer">
              <button id="quiz-editor-save-button">Save Quiz Changes</button>
              <button onclick="QuizEditor.close()">Cancel</button>
          </div>
      </div>
  </div>

  <div id="load-project-modal" class="modal">
      <div class="modal-content medium">
           <span class="close-button" onclick="EditorUI.closeLoadModal()">×</span>
           <h2>Load Project</h2>
           <div id="load-project-list">
               <p>Loading projects...</p>
               <!-- List populated by EditorUI -->
           </div>
           <div class="modal-footer">
                <button onclick="EditorUI.closeLoadModal()">Cancel</button>
           </div>
      </div>
  </div>

  <div id="loading-indicator" class="modal">
      <div class="modal-content small centered">
          <div class="spinner"></div>
          <p>Loading...</p>
      </div>
  </div>

   <div id="error-indicator" class="modal">
      <div class="modal-content small centered error">
          <h3>Error</h3>
          <p id="error-message"></p>
          <button onclick="Utils.hideError()">Close</button>
      </div>
   </div>

  <!-- Scripts -->
  <?!= HtmlService.createHtmlOutputFromFile('js/utils').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('js/serverClient').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('js/stateManager').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('js/canvasController').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('js/quizEditor').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('js/editorUI').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('js/interactionHandler').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('js/main').getContent(); ?>

  <script>
    // Initialize the editor application once the DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        initializeApp('editor');
    });
  </script>
</body>
</html>