<script>
    /**
     * Main application initialization
     */
    function initializeApp(mode, projectId = null) {
      console.log(`Initializing ${mode} mode...`);
      
      try {
        // Show loading indicator
        Utils.showLoadingIndicator(true, mode === 'editor' ? 'Initializing Editor...' : 'Loading Training Content...');
        
        // Initialize state manager
        StateManager.init(mode === 'editor');
        
        // Initialize font loader
        FontLoader.init();
        
        if (mode === 'editor') {
          // Initialize canvas
          CanvasController.initCanvas('editor-canvas', true);
          
          // Initialize editor UI
          EditorUI.initEditorUI();
          
          // Initialize interaction handler
          InteractionHandler.init('editor');
          
          // Hide loading indicator
          Utils.showLoadingIndicator(false);
        } else if (mode === 'viewer' && projectId) {
          // Initialize canvas
          CanvasController.initCanvas('viewer-canvas', false);
          
          // Initialize interaction handler
          InteractionHandler.init('viewer');
          
          // Load project data
          ServerClient.loadProject(projectId)
            .then(jsonString => {
              // Parse project data
              StateManager.loadProjectData(jsonString);
              
              // Load first slide
              CanvasController.loadSlide(StateManager.getCurrentSlide());
              
              // Apply initial sequence state
              InteractionHandler.applyInitialSequenceState();
              
              // Hide loading indicator
              Utils.showLoadingIndicator(false);
            })
            .catch(error => {
              console.error('Failed to load project:', error);
              Utils.showError(`Failed to load training content: ${error.message}`);
              Utils.showLoadingIndicator(false);
            });
        } else {
          Utils.showError('Invalid mode or missing project ID');
          Utils.showLoadingIndicator(false);
        }
      } catch (error) {
        console.error('Initialization error:', error);
        Utils.showError(`Initialization failed: ${error.message}`);
        Utils.showLoadingIndicator(false);
      }
    }
    </script>